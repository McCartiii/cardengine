FROM node:22-alpine
WORKDIR /repo

# Copy workspace manifests for layer-cached install
COPY package.json package-lock.json ./
COPY apps/web/package.json ./apps/web/

RUN npm ci

# Copy source and build
COPY apps/web ./apps/web
RUN npm run build:web

# Remove dev deps to shrink image
RUN npm prune --omit=dev

WORKDIR /repo/apps/web
EXPOSE 3000
# Use shell form so $PORT is expanded at runtime
CMD node_modules/.bin/next start -p ${PORT:-3000}
